.backprop-demo {border:1px solid #e5e5e5; padding:1.1rem 1.2rem; border-radius:14px; background:#ffffff; margin:2.2rem 0; font-family:'Cabin',sans-serif; position:relative;}
.backprop-demo h2 {margin:0 0 .6rem; font-size:1.35rem;}
.bp-intro {margin:0 0 .9rem; font-size:.9rem; color:#555;}
.bp-toolbar {display:flex; flex-wrap:wrap; gap:.55rem .75rem; align-items:center; margin-bottom:.7rem;}
.bp-toolbar button {background:#0b6bcb; color:#fff; border:none; border-radius:6px; padding:.42rem .75rem; font-size:.72rem; font-weight:500; cursor:pointer; letter-spacing:.5px; box-shadow:0 1px 2px rgba(0,0,0,0.12);} 
.bp-toolbar button:hover {background:#095aa9;}
.bp-toolbar button:active {transform:translateY(1px);} 
.bp-toolbar .bp-inline {font-size:.75rem; background:#f4f7fa; padding:.35rem .55rem; border-radius:5px; line-height:1; display:flex; align-items:center; gap:.25rem;}
.bp-toolbar code {background:none; padding:0; font-size:.75rem; color:#0b3659;}
.bp-toolbar label.lr {background:transparent; padding:0;}
#lr {vertical-align:middle; width:90px;}
#bp-network {background:linear-gradient(#fcfdff,#f5f8fa); border:1px solid #d4dae0; border-radius:10px; width:100%; max-width:100%; display:block;}
.bp-formulas {margin-top:.9rem; font-family:'Source Code Pro',monospace; font-size:.7rem; background:#0d1117; color:#cdd9e5; padding:.75rem .8rem; border-radius:8px; line-height:1.3; max-height:260px; overflow:auto;}
.bp-formulas .formula-row {margin:.12rem 0; white-space:nowrap;}
.bp-formulas .grad-title {margin-top:.5rem; color:#5cc4ff;}
/* Phased mode additions */
.backprop-demo.phased {background:radial-gradient(circle at 65% 15%, #f8fbff 0%, #ffffff 60%);} 
.bp-phase-label {margin:.4rem 0 .6rem; font-size:.85rem; font-weight:600; letter-spacing:.5px; color:#18425c; background:#e2f2ff; display:inline-block; padding:.35rem .6rem; border-radius:6px; box-shadow:0 1px 2px rgba(0,0,0,0.08);} 
.bp-mini-legend {margin-top:.6rem; display:flex; flex-wrap:wrap; gap:.4rem;} 
.bp-mini-legend .legend-chip {font-size:.6rem; text-transform:uppercase; letter-spacing:.7px; padding:.25rem .45rem; border-radius:4px; background:#eef2f5; color:#334; font-weight:600;} 
.legend-chip.in {background:#d9ecff;} 
.legend-chip.hid {background:#e9ddff;} 
.legend-chip.out {background:#ffe4cc;} 
.legend-chip.act {background:#c9f7d4;} 
.legend-chip.grad {background:#ffd7e0;} 
.legend-chip.upd {background:#ffeaa7;} 
.bp-toolbar button[disabled]{opacity:.45; cursor:not-allowed;} 

/* Canvas highlight overlays (drawn in JS, but we provide fade class) */
.bp-fade-rest #bp-network {filter:grayscale(.85) brightness(.95);}

/* Canvas wrapper & equation overlay */
.bp-canvas-wrapper {position:relative;}
.bp-equation-overlay {position:absolute; left:14px; top:14px; font-family:'Source Code Pro',monospace; font-size:.78rem; background:rgba(14,20,27,0.82); color:#f2f6fa; padding:.55rem .65rem .5rem; border:1px solid #22313d; border-radius:8px; max-width:280px; line-height:1.25; box-shadow:0 4px 18px -6px rgba(0,0,0,0.4); backdrop-filter:blur(6px); transition:opacity .35s ease, transform .35s ease;}
.bp-equation-overlay.hidden {opacity:0; transform:translateY(-6px); pointer-events:none;}
.bp-equation-overlay .eq-line {opacity:0; transform:translateX(-6px); transition:opacity .45s ease, transform .45s ease;}
.bp-equation-overlay .eq-line.visible {opacity:1; transform:translateX(0);}
.bp-equation-overlay .sym {color:#89d6ff;}
.bp-equation-overlay .num {color:#ffd27f;}
.bp-equation-overlay .fade-out {opacity:.18;}
.bp-equation-overlay .hl {background:#18384b; padding:0 .25rem; border-radius:4px;}
@media (max-width:760px){
	.bp-equation-overlay {position:static; max-width:100%; margin-bottom:.6rem; display:block;}
}

/* Visual pulses for edges (drawn via overlay pseudo elements) future-proof */
.pulse-edge {position:absolute; pointer-events:none; width:12px; height:12px; margin:-6px 0 0 -6px; border-radius:50%; background:radial-gradient(circle,#9dd5ff 0%, rgba(157,213,255,0) 70%); animation:pulse 1.1s ease-out forwards;}
@keyframes pulse {0%{transform:scale(.35); opacity:.9;} 60%{transform:scale(1); opacity:.45;} 100%{transform:scale(1.4); opacity:0;}}

/* Node / weight highlight states injected as classes on canvas wrapper */
.bp-highlight-forward .bp-equation-overlay {border-color:#115b92;}
.bp-highlight-grad .bp-equation-overlay {border-color:#8c2a6d;}
.bp-highlight-update .bp-equation-overlay {border-color:#8a6d09;}

/* Smooth fade for rest-of-network controlled via JS globalAlpha already; we enhance with ambient dim */
.bp-canvas-wrapper.dim-all::after {content:''; position:absolute; inset:0; background:rgba(255,255,255,0.35); pointer-events:none; backdrop-filter:blur(1px);}

@media (max-width:860px){
	#bp-network {height:340px;}
}
@media (max-width:740px){
	#bp-network {height:300px;}
	.bp-toolbar {flex-direction:column; align-items:flex-start;}
	.bp-toolbar .bp-inline {font-size:.68rem;}
}
